{% extends 'base.html' %}
{% block content %}
<h2 class="text-2xl font-semibold mb-4">Diskon</h2>

<!-- Daftar Voucher -->
<h3 class="text-xl font-semibold">Voucher</h3>
<div class="border rounded p-4 mb-4">
    {% for voucher in voucher_data %}
        <div class="border-b pb-2 mb-2">
            <p>Kode: {{ voucher.code }}</p>
            <p>Potongan: {{ voucher.potongan }}</p>
            <p>Min Transaksi: {{ voucher.min_transaksi }}</p>
            <p>Jumlah Hari Berlaku: {{ voucher.hari_berlaku }}</p>
            <p>Kuota Penggunaan: {{ voucher.kuota }}</p>
            <p>Harga: {{ voucher.harga }}</p>
            <button onclick="beliVoucher({{ voucher.id }})" class="bg-blue-500 text-white px-4 py-2 rounded">Beli</button>
        </div>
    {% empty %}
        <p>Tidak ada voucher yang tersedia.</p>
    {% endfor %}
</div>

<!-- Daftar Promo -->
<h3 class="text-xl font-semibold">Promo</h3>
<div class="border rounded p-4">
    {% for promo in promo_data %}
        <div class="border-b pb-2 mb-2">
            <p>Kode: {{ promo.code }}</p>
            <p>Tanggal Akhir Berlaku: {{ promo.expiry_date }}</p>
        </div>
    {% empty %}
        <p>Tidak ada promo yang tersedia.</p>
    {% endfor %}
</div>

<!-- Modal Notifikasi -->
<div id="modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-4 rounded shadow-lg w-80 text-center">
        <h3 id="modal-title" class="text-xl font-bold mb-2"></h3>
        <p id="modal-message" class="mb-4"></p>
        <button onclick="closeModal()" class="bg-blue-500 text-white px-4 py-2 rounded">Tutup</button>
    </div>
</div>

<script>
    function beliVoucher(voucherId) {
        fetch(`/feat_3_blue/beli-voucher/${voucherId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showModal("Sukses", data.message);
            } else {
                showModal("Gagal", data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    }

    function showModal(title, message) {
        document.getElementById("modal-title").textContent = title;
        document.getElementById("modal-message").textContent = message;
        document.getElementById("modal").classList.remove("hidden");
    }

    function closeModal() {
        document.getElementById("modal").classList.add("hidden");
    }
</script>
{% endblock %}
